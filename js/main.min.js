window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame;window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame;try{this.audioContext=new AudioContext()}catch(e){this._updateInfo("!Your browser does not support AudioContext",false);console.log(e)}var audioElement=new Audio();smartSource=function(){if(audioElement.canPlayType("audio/mpeg")){audioElement.setAttribute("src","http://192.30.164.78:8000/rio");$("#mp3").addClass("active")}else{if(audioElement.canPlayType("audio/ogg")){audioElement.setAttribute("src","http://192.30.164.78:8000/airtime");$("#ogg").addClass("active")}}};smartSource();audioElement.controls=false;audioElement.autoplay=false;audioElement.crossOrigin="anonymous";audioElement.id="a";$("#audio-visual")[0].appendChild(audioElement);$("#pause").click(function(){audioElement.pause();$("#pause").addClass("btn-warning");$("#play").removeClass("btn-success");$("#bar").removeClass("active")});$("#reconnect").click(function(){$("#bar").removeClass("active").removeClass("progress-bar-success").addClass("progress-bar-warning");$("#pause").removeClass("btn-warning");smartSource();checkSource();$("#play").removeClass("btn-success");play()});play=function(){audioElement.play();$("#pause").removeClass("btn-warning");$("#bar").addClass("active");$("#play").addClass("btn-success")};$("#play").click(function(){play()});play();audioElement.addEventListener("stalled",function(){console.log("Audio Element Stall");redZone()});audioElement.addEventListener("loadstart",function(){console.log("Audio Element Loading...");$("#bar").addClass("progress-bar-info").removeClass("progress-bar-danger").removeClass("progress-bar-warning").addClass("active");$("#play").removeClass("btn-danger").removeClass("btn-success");$("#pause").removeClass("btn-danger")});audioElement.addEventListener("canplay",function(){console.log("Audio Element Ready to Play");$("#bar").addClass("progress-bar-success").removeClass("progress-bar-info").removeClass("progress-bar-danger").removeClass("progress-bar-warning");$("#play").removeClass("btn-danger").removeClass("btn-success");$("#pause").removeClass("btn-danger");if(audioElement.paused){console.log("Can play but paused")}else{$("#play").addClass("btn-success");$("#pause").removeClass("btn-warning")}});audioElement.addEventListener("abort",function(){console.log("Audio Element Abort");redZone()});redZone=function(){console.log("Red Zoned")};canvas=$("#c")[0];canvasCtx=canvas.getContext("2d");context=new (window.AudioContext||window.webkitAudioContext)();analyser=context.createAnalyser();analyser.fftSize=256;analyser.smoothingTimeConstant=0.5;function freqAnalyser(){window.requestAnimationFrame(freqAnalyser);var g;var b;var a;var c;var k=24;data=new Uint8Array(128);analyser.getByteFrequencyData(data);if(analyser){}else{$("#vis").html(data[0])}canvasCtx.clearRect(0,0,canvas.width,canvas.height);var h=canvasCtx.createLinearGradient(0,canvas.height,0,0);h.addColorStop(0,"#28B62C");h.addColorStop(0.8,"#F5D802");h.addColorStop(1,"red");canvasCtx.fillStyle=h;var l=Math.floor((data.length-40)/k);for(var f=0;f<k;f++){g=0;for(var d=0;d<l;d++){g+=data[(f*l)+d]}b=g/l;a=canvas.width/k;c=(b/256)*canvas.height;canvasCtx.fillRect(f*a,canvas.height,a/1.1,-c)}}function sourceChange(a){if($("#a")[0].src!==a){$("#a")[0].src=a;$("#a")[0].play()}checkSource()}checkSource=function(){if($("#a")[0].src==="http://192.30.164.78:8000/rio"){$("#mp3").addClass("active");$("#ogg").removeClass("active")}else{if($("#a")[0].src==="http://192.30.164.78:8000/airtime"){$("#mp3").removeClass("active");$("#ogg").addClass("active")}}};function respondCanvas(){canvas.width=$("#bottom").width();canvas.height=$("#controlAudio").height()-72}$("document").ready(function(){source1=context.createMediaElementSource(audioElement);source1.connect(analyser);analyser.connect(context.destination);freqAnalyser();respondCanvas();$(window).resize(respondCanvas);$("#headerLiveTrackHolder").airtimeLiveTrackInfo({sourceDomain:"http://radio.riocast.net",text:{onAirNow:"AL AIRE",offline:"Offline",current:"Reproduciéndo ahora",next:"Próximamente"},updatePeriod:20});$("#onAirToday").airtimeShowSchedule({sourceDomain:"http://radio.riocast.net",updatePeriod:20,showLimit:20});if(window.audioContext||window.webkitAudioContext){console.log("audioContext Supported")}else{$("#vis").hide()}});